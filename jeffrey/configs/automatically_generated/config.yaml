# Do not edit this file. It is automatically generated by jeffrey/generate_final_config.py.
# If you want to modify configuration, edit source files in jeffrey/configs directory.

defaults:
  # - config_schema

  - override hydra/job_logging: custom
  - override hydra/hydra_logging: disabled
  - _self_

hydra:
  output_subdir: null
  run:
    dir: .
infrastructure:
  project_id: e2eml-jiho-430901
  zone: asia-northeast3-a
  region: asia-northeast3
  instance_group_creator:
    _target_: jeffrey.infrastructure.instance_group_creator.InstanceGroupCreator
    instance_template_creator:
      _target_: jeffrey.infrastructure.instance_template_creator.InstanceTemplateCreator
      scopes:
      - https://www.googleapis.com/auth/cloud-platform
      - https://www.googleapis.com/auth/cloud.useraccounts.readonly
      - https://www.googleapis.com/auth/cloudruntimeconfig
      network: https://www.googleapis.com/compute/v1/projects/e2eml-jiho-430901/global/networks/default
      subnetwork: https://www.googleapis.com/compute/v1/projects/e2eml-jiho-430901/regions/asia-northeast3/subnetworks/default
      startup_script_path: scripts/vm_startup/task_runner_startup_script.sh
      vm_config:
        machine_type: g2-standard-8
        accelerator_count: 1
        accelerator_type: nvidia-l4
        vm_type: STANDARD
        disks: []
      boot_disk_config:
        project_id: deeplearning-platform-release
        image_name: common-cu118-v20240730
        size_gb: 50
        labels:
          project: e2eml-jiho-430901
      vm_metadata_config:
        zone: asia-northeast3-a
        instance_group_name: job-20240924121218
        node_count: 1
        disks: []
        docker_image: asia-northeast3-docker.pkg.dev/e2eml-jiho-430901/cyberbullying-detection-model/cyberbullying-model:train-bfb7ee18-12b1-46b5-bc7e-29628a97e780
        mlflow_tracking_uri: http://e2eml-jiho-mlflow.asia-northeast3-c.c.e2eml-jiho-430901.internal:6100
        python_hash_seed: 42
        etcd_ip: 10.178.15.197:2379
      template_name: job-20240924121218
      project_id: e2eml-jiho-430901
      labels:
        project: e2eml-jiho-430901
    name: job-20240924121218
    node_count: 1
    project_id: e2eml-jiho-430901
    zone: asia-northeast3-a
  mlflow:
    mlflow_external_tracking_uri: http://localhost:6100
    mlflow_internal_tracking_uri: http://e2eml-jiho-mlflow.asia-northeast3-c.c.e2eml-jiho-430901.internal:6100
    experiment_name: Default
    run_name: null
    run_id: f841d5fefecd421b848d3923102678ec
    experiment_id: '0'
    experiment_url: http://localhost:6100/#/experiments/0/runs/f841d5fefecd421b848d3923102678ec
    artifact_uri: gs://detect-cyberbullying/0/f841d5fefecd421b848d3923102678ec/artifacts
    block_mlflow: false
  etcd_ip: 10.178.15.197:2379
save_last_checkpoint_every_n_train_steps: 50
seed: 1234
tasks:
  binary_text_classification_task:
    _target_: jeffrey.training.tasks.tar_model_exporting_training_task.TarModelExportingTrainingTask
    task_name: binary_text_classification_task
    data_module:
      _target_: jeffrey.data_modules.data_modules.TextClassificationDataModule
      batch_size: 64
      shuffle: false
      num_workers: 8
      pin_memory: true
      drop_last: true
      persistent_workers: false
      train_df_path: gs://jeffrey-data-versioning/data/processed/rebalanced_splits/train.parquet
      valid_df_path: gs://jeffrey-data-versioning/data/processed/rebalanced_splits/valid.parquet
      test_df_path: gs://jeffrey-data-versioning/data/processed/rebalanced_splits/test.parquet
      text_column_name: cleaned_text
      label_column_name: label
      transformation:
        _target_: jeffrey.models.transformations.HuggingFaceTokenizationTransformation
        pretrained_tokenizer_name_or_path: gs://jeffrey-data-versioning/data/processed/rebalanced_splits/trained_tokenizer
        max_sequence_len: 100
    lightning_module:
      _target_: jeffrey.training.lightning_modules.binary_text_classification.BinaryTextClassificationLightningModule
      model:
        _target_: jeffrey.models.models.BinaryTextClassificationModel
        backbone:
          _target_: jeffrey.models.backbones.HuggingFaceBackbone
          transformation:
            _target_: jeffrey.models.transformations.HuggingFaceTokenizationTransformation
            pretrained_tokenizer_name_or_path: gs://jeffrey-data-versioning/data/processed/rebalanced_splits/trained_tokenizer
            max_sequence_len: 100
          pretrained_model_name_or_path: prajjwal1/bert-tiny
          pretrained: false
        head:
          _target_: jeffrey.models.heads.SigmoidHead
          in_features: 128
          out_features: 1
        adapter:
          _target_: jeffrey.models.adapters.MLPWithPooling
          output_feature_sizes:
          - -1
          biases: null
          activation_funcs: null
          dropout_rates: null
          batch_norms: null
          order: LBADN
          standardize_input: true
          pooling_method: null
          output_attribute_to_use: pooler_output
      loss:
        _target_: jeffrey.training.loss_functions.BCEWithLogitsLoss
        reduction: mean
      optimizer:
        _target_: torch.optim.AdamW
        _partial_: true
        lr: 0.005
        betas:
        - 0.9
        - 0.999
        eps: 1.0e-08
        weight_decay: 0.0
        amsgrad: false
        foreach: null
        maximize: false
        capturable: false
      scheduler:
        _target_: jeffrey.training.schedulers.CommonLightningScheduler
        scheduler:
          _target_: torch.optim.lr_scheduler.ReduceLROnPlateau
          _partial_: true
          mode: max
          factor: 0.1
          patience: 5
          threshold: 0.0001
          threshold_mode: rel
          cooldown: 0
          min_lr: 0.0
          eps: 1.0e-08
          verbose: false
        interval: epoch
        frequency: 1
        monitor: validation_f1_score
        strict: true
        name: null
    trainer:
      _target_: lightning.pytorch.trainer.trainer.Trainer
      accelerator: cuda
      strategy: ddp_find_unused_parameters_true
      devices: auto
      num_nodes: 1
      precision: 16-mixed
      logger:
      - _target_: lightning.pytorch.loggers.mlflow.MLFlowLogger
        experiment_name: Default
        run_name: null
        tracking_uri: http://e2eml-jiho-mlflow.asia-northeast3-c.c.e2eml-jiho-430901.internal:6100
        tags: null
        save_dir: null
        prefix: ''
        artifact_location: null
        run_id: f841d5fefecd421b848d3923102678ec
      callbacks:
      - _target_: lightning.pytorch.callbacks.ModelCheckpoint
        dirpath: gs://detect-cyberbullying/0/f841d5fefecd421b848d3923102678ec/artifacts/best-checkpoints/
        filename: null
        monitor: validation_f1_score
        verbose: false
        save_last: true
        save_top_k: 2
        mode: max
        auto_insert_metric_name: false
        save_weights_only: false
        every_n_train_steps: null
        train_time_interval: null
        every_n_epochs: null
        save_on_train_epoch_end: null
      - _target_: lightning.pytorch.callbacks.ModelCheckpoint
        dirpath: gs://detect-cyberbullying/0/f841d5fefecd421b848d3923102678ec/artifacts/last-checkpoints/
        filename: checkpoint-{epoch}
        monitor: null
        verbose: false
        save_last: true
        save_top_k: -1
        mode: min
        auto_insert_metric_name: false
        save_weights_only: false
        every_n_train_steps: 50
        train_time_interval: null
        every_n_epochs: null
        save_on_train_epoch_end: null
      - _target_: lightning.pytorch.callbacks.LearningRateMonitor
        logging_interval: step
      fast_dev_run: false
      max_epochs: 3
      min_epochs: null
      max_steps: -1
      min_steps: null
      max_time: null
      limit_train_batches: 0.01
      limit_val_batches: 0.01
      limit_test_batches: 0.01
      limit_predict_batches: 1.0
      overfit_batches: 0.0
      val_check_interval: 1.0
      check_val_every_n_epoch: 1
      num_sanity_val_steps: 2
      log_every_n_steps: 1
      enable_checkpointing: true
      enable_progress_bar: true
      enable_model_summary: true
      accumulate_grad_batches: 1
      gradient_clip_val: 5.0
      gradient_clip_algorithm: value
      deterministic: null
      benchmark: null
      inference_mode: true
      use_distributed_sampler: true
      detect_anomaly: false
      barebones: false
      sync_batchnorm: true
      reload_dataloaders_every_n_epochs: 0
      default_root_dir: ./data/pytorch-lightning
    best_training_checkpoint: gs://detect-cyberbullying/0/f841d5fefecd421b848d3923102678ec/artifacts/best-checkpoints/last.ckpt
    last_training_checkpoint: gs://detect-cyberbullying/0/f841d5fefecd421b848d3923102678ec/artifacts/last-checkpoints/lask.ckpt
    tar_model_export_path: gs://detect-cyberbullying/0/f841d5fefecd421b848d3923102678ec/artifacts/exported_model.tar.gz
  binary_text_evaluation_task:
    _target_: jeffrey.evaluation.tasks.common_evaluation_task.CommonEvaluationTask
    task_name: binary_text_evaluation_task
    data_module:
      _target_: jeffrey.data_modules.data_modules.TextClassificationDataModule
      batch_size: 64
      shuffle: false
      num_workers: 8
      pin_memory: true
      drop_last: true
      persistent_workers: false
      train_df_path: gs://jeffrey-data-versioning/data/processed/rebalanced_splits/train.parquet
      valid_df_path: gs://jeffrey-data-versioning/data/processed/rebalanced_splits/valid.parquet
      test_df_path: gs://jeffrey-data-versioning/data/processed/rebalanced_splits/test.parquet
      text_column_name: cleaned_text
      label_column_name: label
      transformation:
        _target_: jeffrey.models.transformations.HuggingFaceTokenizationTransformation
        pretrained_tokenizer_name_or_path: gs://jeffrey-data-versioning/data/processed/rebalanced_splits/trained_tokenizer
        max_sequence_len: 100
    lightning_module:
      _target_: jeffrey.evaluation.lightning_modules.binary_text_evaluation.BinaryTextEvaluationLightningModule
      _partial_: true
    trainer:
      _target_: lightning.pytorch.trainer.trainer.Trainer
      accelerator: cuda
      strategy: ddp_find_unused_parameters_true
      devices: auto
      num_nodes: 1
      precision: 16-mixed
      logger:
      - _target_: lightning.pytorch.loggers.mlflow.MLFlowLogger
        experiment_name: Default
        run_name: null
        tracking_uri: http://e2eml-jiho-mlflow.asia-northeast3-c.c.e2eml-jiho-430901.internal:6100
        tags: null
        save_dir: null
        prefix: ''
        artifact_location: null
        run_id: f841d5fefecd421b848d3923102678ec
      callbacks:
      - _target_: lightning.pytorch.callbacks.ModelCheckpoint
        dirpath: gs://detect-cyberbullying/0/f841d5fefecd421b848d3923102678ec/artifacts/best-checkpoints/
        filename: null
        monitor: validation_f1_score
        verbose: false
        save_last: true
        save_top_k: 2
        mode: max
        auto_insert_metric_name: false
        save_weights_only: false
        every_n_train_steps: null
        train_time_interval: null
        every_n_epochs: null
        save_on_train_epoch_end: null
      - _target_: lightning.pytorch.callbacks.ModelCheckpoint
        dirpath: gs://detect-cyberbullying/0/f841d5fefecd421b848d3923102678ec/artifacts/last-checkpoints/
        filename: checkpoint-{epoch}
        monitor: null
        verbose: false
        save_last: true
        save_top_k: -1
        mode: min
        auto_insert_metric_name: false
        save_weights_only: false
        every_n_train_steps: 50
        train_time_interval: null
        every_n_epochs: null
        save_on_train_epoch_end: null
      - _target_: lightning.pytorch.callbacks.LearningRateMonitor
        logging_interval: step
      fast_dev_run: false
      max_epochs: 3
      min_epochs: null
      max_steps: -1
      min_steps: null
      max_time: null
      limit_train_batches: 0.01
      limit_val_batches: 0.01
      limit_test_batches: 0.01
      limit_predict_batches: 1.0
      overfit_batches: 0.0
      val_check_interval: 1.0
      check_val_every_n_epoch: 1
      num_sanity_val_steps: 2
      log_every_n_steps: 1
      enable_checkpointing: true
      enable_progress_bar: true
      enable_model_summary: true
      accumulate_grad_batches: 1
      gradient_clip_val: 5.0
      gradient_clip_algorithm: value
      deterministic: null
      benchmark: null
      inference_mode: true
      use_distributed_sampler: true
      detect_anomaly: false
      barebones: false
      sync_batchnorm: true
      reload_dataloaders_every_n_epochs: 0
      default_root_dir: ./data/pytorch-lightning
    tar_model_path: gs://detect-cyberbullying/0/f841d5fefecd421b848d3923102678ec/artifacts/exported_model.tar.gz
model_selector:
  _target_: jeffrey.evaluation.model_selector.ModelSelector
  mlflow_run_id: f841d5fefecd421b848d3923102678ec
  must_be_better_metric_comparers:
    f1_score:
      _target_: jeffrey.evaluation.model_selector.MetricComparer
      bigger_is_better: true
      can_be_equal: false
      metric_name: test_f1_score
      delta: 0.0
    model_size:
      _target_: jeffrey.evaluation.model_selector.MetricComparer
      bigger_is_better: false
      can_be_equal: true
      metric_name: model_size
      delta: 0.0
  to_be_thresholded_metric_comparers: {}
  threshold: 0.0
registered_model_name: bert_tiny
docker_image: asia-northeast3-docker.pkg.dev/e2eml-jiho-430901/cyberbullying-detection-model/cyberbullying-model:train-bfb7ee18-12b1-46b5-bc7e-29628a97e780
